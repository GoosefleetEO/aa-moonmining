{% extends 'allianceauth/base.html' %}
{% load i18n %}
{% block page_title %}{% trans 'Moon List' %}{% endblock %}
{% load static %}

{% block content %}
    <div class="col-lg-12">
        <br>
        {% include 'moonplanner/partials/menu.html' %}
        <h2> {{ title }} </h2>

        <div id="loader">
			{% if NIGHT_MODE %}
                <img src="{% static 'moonplanner/img/Spinner-1s-64px-dark.gif' %}" alt="Spinner"/>
            {% else %}
                <img src="{% static 'moonplanner/img/Spinner-1s-64px-light.gif' %}" alt="Spinner"/>
            {% endif %}
		</div>

        <div id="moon_table" style="display: none !important;">
            <table class="table table-striped" id="moon-list" style="width:100%;">
                <thead>
                    <th>Moon</th>
                    <th>Corporation</th>
                    <th>System</th>
                    <th>Region</th>
                    <th>Value est. (B ISK) *</th>
                    <th>Details</th>
                </thead>
                <tbody>
                </tbody>
            </table>
            {% include 'moonplanner/partials/value_estimate_legend.html' %}
        </div>
    </div>



{% endblock %}
{% block extra_javascript %}
    {% include 'bundles/datatables-js.html' %}
    <!--load JS for filterDropDown plugin -->
    <script type="text/javascript" src="{% static 'js/filterDropDown/filterDropDown.min.js' %}"></script>
    <script type="text/javascript">
        $(function(){
            /* datatable definition */
            var table = $('#moon-list').DataTable({
                ajax: {
                    url: '{{ ajax_url }}',
                    dataSrc: '',
                    cache: true
                },
                columns: [
                    { data: 'moon_name' },
                    { data: 'corporation',
                        render: {
                            _: 'display',
                            sort: 'sort'
                        }
                    },
                    { data: 'solar_system_link' },
                    { data: 'region_name' },
                    { data: 'value' },
                    { data: 'details' },

                    { data: 'solar_system_name' },
                    { data: 'has_refinery_str' },
                    { data: 'corporation_name' },
                    { data: 'alliance_name' },
                ],
                lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
                pageLength: 10,
                order: [ [0, "asc"] ],
                columnDefs: [
                    { "orderable": false, "targets": [ 5 ] },
                    { "visible": false, "targets": [ 6, 7, 8, 9 ] },
                ],
                filterDropDown: {
                    columns: [
                        {
                            idx: 9,
                            title: "Alliance"
                        },
                        {
                            idx: 8,
                            title: "Corporation"
                        },
                        {
                            idx: 3
                        },
                        {
                            idx: 6,
                            title: "System"
                        },
                        {
                            idx: 7,
                            title: "Our moon"
                        }
                    ],
                    bootstrap: true,
                    autoSize: false
                },
                createdRow: function( row, data, dataIndex )
                {
                    if (data['has_refinery'])
                    {
                        $(row).addClass('success');
                    }
                }
            });

            /* show table after loading from AJAX source is complete */
            table.on( 'xhr', function () {
                table.columns.adjust().draw();
                $("#loader").hide();
                $("#moon_table").show();
            } );
        });
    </script>
{% endblock %}
{% block extra_css %}
    {% include 'bundles/datatables-css.html' %}
    <link href="{% static 'moonplanner/css/moon_list.css' %}" type="text/css" rel="stylesheet">
{% endblock %}
{% block extra_script %}
{% endblock %}
