{% extends 'allianceauth/base.html' %}
{% load i18n %}
{% block page_title %}{% trans 'Moon List' %}{% endblock %}
{% load static %}

{% block content %}
    <div class="col-lg-12">
        <br>
        {% include 'moonplanner/menu.html' %}
        <h2> {{ title }} </h2>
                
        <div id="loader">
			<img class="center-block" src="{% static "moonplanner/Spinner-1s-200px.gif" %}" alt="Spinner"/>
		</div>
        
        <div id="moon_table" style="display: none !important;">
            <table class="table table-striped" id="moon-list" style="width:100%;">
                <thead>
                    <th>Moon</th>
                    <th>Corporation</th>
                    <th>System</th>
                    <th>Region</th>
                    <th>Monthly income est. in B ISK</th>
                    <th>Details</th>
                </thead>
                <tbody>                   
                </tbody>
            </table>
        </div>
    </div>
    <p class="text-muted">
        Income estimates are calculated using reprocessed ores, 
        current average market prices, 
        a reprocessing yield of {{ reprocessing_yield|floatformat }}%
        and an assumed monthly ore volume of {{ total_volume_per_month }} million m3
    </p>


{% endblock %}
{% block extra_javascript %}
    {% include 'bundles/datatables-js.html' %}
    <!--load JS for filterDropDown plugin -->
    <script 
        type="text/javascript" 
        src="{% static "moonplanner/filterDropDown.min.js" %}">
    </script>
{% endblock %}
{% block extra_css %}
    {% include 'bundles/datatables-css.html' %}

    <link 
        href="{% static "moonplanner/moon_list.css" %}" 
        type="text/css" 
        rel="stylesheet"
    >
{% endblock %}
{% block extra_script %}
    $(function(){
        /* datatable definition */
        var table = $('#moon-list').DataTable({
            ajax: {
                url: '{{ ajax_url }}',                
                dataSrc: '',
                cache: true
            },	

            columns: [																			
                { data: 'moon_name' },
                { data: 'corporation' },
                { data: 'solar_system_link' },
                { data: 'region_name' },
                { data: 'income' },
                { data: 'details' },

                { data: 'solar_system_name' },
                { data: 'has_refinery_str' },
            ],

            lengthMenu: [[8, 15, 25, 50, -1], [8, 15, 25, 50, "All"]],

            order: [ [0, "asc"] ],

            columnDefs: [														
                { "orderable": false, "targets": [ 5 ] },
                { "visible": false, "targets": [ 6, 7 ] },
            ],
      
            filterDropDown: {										
                columns: [																                    
                    { 
                        idx: 1
                    },
                    { 
                        idx: 3
                    },
                    { 
                        idx: 6,
                        title: "System"
                    }
                    ,
                    { 
                        idx: 7,
                        title: "Our moon"
                    }
                ],
                bootstrap: true,
                autoSize: false
            },

            createdRow: function( row, data, dataIndex ) 
            {
                if (data['has_refinery'])
                {
                    $(row).addClass('success');
                }               
            }
            
        });

        /* show table after loading from AJAX source is complete */
        table.on( 'xhr', function () {						
            table.columns.adjust().draw();
            $("#loader").hide();
            $("#moon_table").show();
        } );
    });
{% endblock %}